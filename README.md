### Общая идея проекта

Этот проект представляет собой автоматизированный инструмент для поиска выгодных предложений по покупке подержанных автомобилей Volvo XC60 на сайте `polovniautomobili.com`.

Процесс состоит из двух основных этапов:

1.  **Сбор данных:** Скрипт `src/scrape_polovni_botasaurus.py` собирает актуальные объявления с сайта и сохраняет их в `data/raw/polovni_automobili.csv`.
2.  **Анализ и поиск:** Скрипт `src/analyze_price_vs_mileage.py` использует статистический анализ для моделирования рыночной цены на основе пробега и года выпуска. Затем он выявляет автомобили, которые продаются по цене значительно ниже ожидаемой, и представляет их в виде интерактивного HTML графика (`results/xc60_price_vs_mileage.html`) и отдельного списка (`results/xc60_candidates.csv`) для дальнейшего рассмотрения.

---

### Описание скриптов

*   **`src/scrape_polovni_botasaurus.py`**: Этот скрипт осуществляет скрапинг сайта `polovniautomobili.com` для сбора информации об автомобилях Volvo XC60 (начиная с 2020 года). Он извлекает данные о цене, пробеге, годе выпуска и сохраняет их в файл `data/raw/polovni_automobili.csv`.

*   **`src/analyze_price_vs_mileage.py`**: Этот скрипт анализирует собранные данные. Он строит модель линейной регрессии для оценки влияния пробега и года на цену. Скрипт генерирует интерактивный HTML-график для визуализации этой зависимости и создает CSV-файл с "кандидатами" — автомобилями, которые потенциально являются выгодными покупками.

### Структура проекта

Проект имеет следующую структуру для обеспечения чистоты, масштабируемости и воспроизводимости:

*   **`src/`**: Директория для всего исходного кода Python.
    *   `scrape_polovni_botasaurus.py`: Скрипт для сбора данных.
    *   `analyze_price_vs_mileage.py`: Скрипт для анализа данных.

*   **`data/`**: Директория для хранения данных.
    *   **`data/raw/`**: Здесь хранятся "сырые", неизмененные данные, полученные напрямую от скрапера. Эта папка является "источником правды" и ее содержимое не должно изменяться вручную. Это гарантирует воспроизводимость анализа.

*   **`results/`**: Директория для сохранения всех результатов работы скриптов, таких как HTML-отчеты и CSV-файлы с кандидатами.

*   **`tests/`**: Директория для будущих тестов.

*   **`notebooks/`**: Директория для Jupyter-ноутбуков, если они будут использоваться для исследовательского анализа.

*   **`.gitignore`**: Файл для исключения ненужных файлов и папок (таких как `venv`, `data`, `results`) из системы контроля версий Git.

*   **`README.md`**: Файл, который вы сейчас читаете.

*   **`requirements.txt`**: Список всех необходимых для проекта библиотек Python.

### История разработки и исправленные ошибки

В ходе разработки проекта был выявлен и исправлен ряд ошибок:

1.  **Проблемы с зависимостями:** Изначально в коде использовались устаревшие импорты из библиотеки `botasaurus`. Ошибки `ImportError` и `TypeError` были исправлены путем обновления кода в соответствии с последней версией библиотеки.
2.  **Ошибки парсинга:**
    *   **Неполный сбор данных:** Первая версия парсера не учитывала все варианты структуры объявлений, из-за чего собиралась только часть данных. Логика была переработана для более надежного поиска всех объявлений на странице.
    *   **Некорректные цены:** Было обнаружено, что для объявлений со скидкой старая и новая цена "склеивались" в одно большое число. Эта проблема была решена в несколько итераций. Финальная версия парсера использует наиболее надежный источник — `data-price` атрибут HTML-тега объявления, что гарантирует получение корректной, актуальной цены.
3.  **Улучшение анализа:** Порог для определения "выгодных" предложений в скрипте анализа был скорректирован для лучшего соответствия реальным данным.
4.  **Интерактивность:**
    *   **Проблема:** Изначально ссылка на объявление была во всплывающей подсказке, но подсказка исчезала при попытке навести на нее курсор.
    *   **Решение:** Я встроил JavaScript код прямо в HTML файл с графиком. Этот код делает каждую точку на графике кликабельной. Теперь при клике на точку в новой вкладке открывается соответствующее объявление. Это обеспечивает гораздо более удобное взаимодействие с графиком.
    *   **Отладка:** В процессе реализации этой функции возникали ошибки, связанные с генерацией HTML и внедрением JavaScript. Проблема была решена путем генерации полного HTML-кода графика и последующей вставки JavaScript перед закрывающим тегом `</body>`.

### Как запустить

1.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```

2.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

3.  **Запустите скрапинг для сбора данных:**
    ```bash
    python3 src/scrape_polovni_botasaurus.py
    ```

4.  **Запустите анализ данных:**
    ```bash
    python3 src/analyze_price_vs_mileage.py
    ```

После выполнения этих шагов у вас будут файлы `results/xc60_price_vs_mileage.html` (интерактивный график) и `results/xc60_candidates.csv` (список выгодных предложений).
